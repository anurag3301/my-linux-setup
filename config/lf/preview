#!/bin/sh

# Clear the last preview
kitty +kitten icat --clear --stdin no --silent --transfer-mode file </dev/null >/dev/tty

# Define preview command: use `bat` if available, otherwise `cat`
if command -v bat >/dev/null 2>&1; then
    preview_cmd="bat --style=plain --paging=never --color=always"  # `--style=plain` removes decorations, `--paging=never` prevents paging
else
    preview_cmd="cat"
fi

# Image preview
if [ -f "$1" ] && [ -n "$KITTY_WINDOW_ID" ]; then
    case "$(file --mime-type -b "$1")" in
        image/*)
            kitten icat --silent --stdin no --transfer-mode file --place "${2}x${3}@${4}x${5}" "$1" >/dev/tty
            exit 1
            ;;
    esac
fi

# Check for ASCII files and display content with chosen command
if file "$1" | grep -q 'ASCII text'; then
    $echo $preview_cmd "$1"
    exit 0
fi

# Other file previews (add as needed)
case "$1" in
    *.md) $preview_cmd "$1";;
    *.json) $preview_cmd "$1";;
    *) file -b "$1";;
esac
